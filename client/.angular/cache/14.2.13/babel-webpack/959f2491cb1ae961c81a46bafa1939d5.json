{"ast":null,"code":"import _asyncToGenerator from \"/home/shubham/2023/email_otp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { AbstractControl, FormControl, FormGroup, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../api-service.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\n\nfunction LoginComponent_div_6_label_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\");\n    i0.ɵɵtext(1, \"Only emails from the \\\".dso.org.sg\\\" domain should be allowed\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LoginComponent_div_6_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"input\", 6)(2, \"br\");\n    i0.ɵɵelementStart(3, \"label\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Remaining retry attemps : \", ctx_r2.retryAttempts, \"\");\n  }\n}\n\nfunction LoginComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵelement(2, \"input\", 4)(3, \"br\");\n    i0.ɵɵtemplate(4, LoginComponent_div_6_label_4_Template, 2, 0, \"label\", 3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, LoginComponent_div_6_div_5_Template, 5, 1, \"div\", 3);\n    i0.ɵɵelementStart(6, \"input\", 5);\n    i0.ɵɵlistener(\"click\", function LoginComponent_div_6_Template_input_click_6_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.submit());\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showMessage);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.sentOTP);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"value\", ctx_r0.button);\n  }\n}\n\nexport class LoginComponent {\n  constructor(apiService) {\n    this.apiService = apiService;\n    this.name = 'Angular';\n    this.button = 'Send OTP';\n    this.emailDisable = false;\n    this.loginForm = FormGroup;\n    this.retryAttempts = 10;\n    this.sentOTP = false;\n    this.otp = 0;\n    this.email = '';\n    this.showMessage = false;\n    this.OTP_Verified = false;\n    this.screen_lable = 'Login';\n  }\n\n  ngOnInit() {\n    this.loginForm = new FormGroup({\n      email: new FormControl(null, [Validators.required]),\n      otp: new FormControl()\n    });\n  }\n\n  setValidatorForOTP() {\n    const otpControl = this.loginForm.get('otp'); // Check if the control exists\n\n    if (otpControl) {\n      // Add your custom validator function\n      otpControl.addValidators(Validators.required); // Update the validity status\n\n      otpControl.updateValueAndValidity();\n    }\n  }\n\n  sendOTP() {\n    this.emailDisable = true;\n    this.sentOTP = true;\n    this.button = 'Continue with OTP';\n  }\n\n  sendEmail() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.otp = Math.floor(100000 + Math.random() * 900000);\n      console.log(\"otp : \", _this.otp);\n      console.log(\"send email on \" + _this.email + \" with OTP : \", _this.otp);\n      let response = yield _this.apiService.sendEmail(_this.email, _this.otp);\n      console.log(\"response : \", response);\n    })();\n  }\n\n  submit() {\n    console.log(\"Form : \", this.loginForm.status); // if(!this.loginForm.value.email.endsWith(\".dso.org.sg\")){\n    //   console.log(\"Please use correct email \");\n    //   this.showMessage = true;\n    //   return;\n    // }else{\n    //   this.showMessage = false;\n    // }\n\n    if (this.loginForm.status == 'VALID' && this.loginForm.value.email // && this.loginForm.value.email.endsWith(\".dso.org.sg\") \n    && !this.loginForm.value.otp) {\n      this.email = this.loginForm.value.email;\n      this.setValidatorForOTP();\n      this.sendOTP();\n      this.sendEmail();\n    } else if (this.loginForm.status == 'VALID' && this.loginForm.value.email && this.loginForm.value.otp && this.loginForm.value.email && this.email && this.loginForm.value.otp == this.otp) {\n      this.retryAttempts = 0;\n      this.OTP_Verified = true;\n      this.screen_lable = 'Email OTP verification done successfully';\n      console.log(\"OTP Verified\");\n    } else if (this.loginForm.status == 'VALID' && this.loginForm.value.email && this.loginForm.value.otp && this.loginForm.value.otp != this.otp) {\n      this.retryAttempts = this.retryAttempts - 1;\n      console.log(\"Incorrect OTP with remaining attempts : \", this.retryAttempts);\n    }\n  }\n\n}\n\nLoginComponent.ɵfac = function LoginComponent_Factory(t) {\n  return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.ApiServiceService));\n};\n\nLoginComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: LoginComponent,\n  selectors: [[\"app-login\"]],\n  decls: 7,\n  vars: 3,\n  consts: [[1, \"wrapper\", \"fadeInDown\"], [\"id\", \"formContent\"], [3, \"formGroup\"], [4, \"ngIf\"], [\"type\", \"text\", \"id\", \"email\", \"formControlName\", \"email\", \"placeholder\", \"email\", 1, \"fadeIn\", \"second\"], [\"type\", \"submit\", 1, \"fadeIn\", \"fourth\", 3, \"value\", \"click\"], [\"type\", \"text\", \"id\", \"otp\", \"formControlName\", \"otp\", \"placeholder\", \"otp\", 1, \"fadeIn\", \"third\"]],\n  template: function LoginComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n      i0.ɵɵelement(3, \"br\");\n      i0.ɵɵelementStart(4, \"h3\");\n      i0.ɵɵtext(5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(6, LoginComponent_div_6_Template, 7, 3, \"div\", 3);\n      i0.ɵɵelementEnd()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.loginForm);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate1(\" \", ctx.screen_lable, \" \");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.OTP_Verified);\n    }\n  },\n  dependencies: [i2.NgIf, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.FormControlName],\n  styles: [\"html[_ngcontent-%COMP%] {\\n  background-color: #56baed;\\n}\\nbody[_ngcontent-%COMP%] {\\n  font-family: \\\"Poppins\\\", sans-serif;\\n  height: 100vh;\\n}\\na[_ngcontent-%COMP%] {\\n  color: #92badd;\\n  display: inline-block;\\n  text-decoration: none;\\n  font-weight: 400;\\n}\\nh2[_ngcontent-%COMP%] {\\n  text-align: center;\\n  font-size: 16px;\\n  font-weight: 600;\\n  text-transform: uppercase;\\n  display: inline-block;\\n  margin: 40px 8px 10px 8px;\\n  color: #cccccc;\\n}\\n\\n.wrapper[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  flex-direction: column;\\n  justify-content: center;\\n  width: 100%;\\n  min-height: 100%;\\n  padding: 20px;\\n}\\n#formContent[_ngcontent-%COMP%] {\\n  border-radius: 10px 10px 10px 10px;\\n  background: #fff;\\n  padding: 30px;\\n  width: 90%;\\n  max-width: 450px;\\n  position: relative;\\n  padding: 0px;\\n  box-shadow: 0 30px 60px 0 rgba(0, 0, 0, 0.3);\\n  text-align: center;\\n}\\n#formFooter[_ngcontent-%COMP%] {\\n  background-color: #f6f6f6;\\n  border-top: 1px solid #dce8f1;\\n  padding: 25px;\\n  text-align: center;\\n  border-radius: 0 0 10px 10px;\\n}\\n\\nh2.inactive[_ngcontent-%COMP%] {\\n  color: #cccccc;\\n}\\nh2.active[_ngcontent-%COMP%] {\\n  color: #0d0d0d;\\n  border-bottom: 2px solid #5fbae9;\\n}\\n\\ninput[type=button][_ngcontent-%COMP%], input[type=submit][_ngcontent-%COMP%], input[type=reset][_ngcontent-%COMP%] {\\n  background-color: #56baed;\\n  border: none;\\n  color: white;\\n  padding: 15px 80px;\\n  text-align: center;\\n  text-decoration: none;\\n  display: inline-block;\\n  text-transform: uppercase;\\n  font-size: 13px;\\n  box-shadow: 0 10px 30px 0 rgba(95, 186, 233, 0.4);\\n  border-radius: 5px 5px 5px 5px;\\n  margin: 5px 20px 40px 20px;\\n  transition: all 0.3s ease-in-out;\\n}\\ninput[type=button][_ngcontent-%COMP%]:hover, input[type=submit][_ngcontent-%COMP%]:hover, input[type=reset][_ngcontent-%COMP%]:hover {\\n  background-color: #39ace7;\\n}\\ninput[type=button][_ngcontent-%COMP%]:active, input[type=submit][_ngcontent-%COMP%]:active, input[type=reset][_ngcontent-%COMP%]:active {\\n  transform: scale(0.95);\\n}\\ninput[type=text][_ngcontent-%COMP%] {\\n  background-color: #f6f6f6;\\n  border: none;\\n  color: #0d0d0d;\\n  padding: 15px 32px;\\n  text-align: center;\\n  text-decoration: none;\\n  display: inline-block;\\n  font-size: 16px;\\n  margin: 5px;\\n  width: 85%;\\n  border: 2px solid #f6f6f6;\\n  transition: all 0.5s ease-in-out;\\n  border-radius: 5px 5px 5px 5px;\\n}\\ninput[type=text][_ngcontent-%COMP%]:focus {\\n  background-color: #fff;\\n  border-bottom: 2px solid #5fbae9;\\n}\\ninput[type=text][_ngcontent-%COMP%]:placeholder {\\n  color: #cccccc;\\n}\\n\\n\\n.fadeInDown[_ngcontent-%COMP%] {\\n  animation-name: fadeInDown;\\n  animation-duration: 1s;\\n  animation-fill-mode: both;\\n}\\n@keyframes fadeInDown {\\n  0% {\\n    opacity: 0;\\n    transform: translate3d(0, -100%, 0);\\n  }\\n  100% {\\n    opacity: 1;\\n    transform: none;\\n  }\\n}\\n\\n@keyframes fadeIn {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n.fadeIn[_ngcontent-%COMP%] {\\n  opacity: 0;\\n  animation: fadeIn ease-in 1;\\n  animation-fill-mode: forwards;\\n  animation-duration: 1s;\\n}\\n.fadeIn.first[_ngcontent-%COMP%] {\\n  animation-delay: 0.4s;\\n}\\n.fadeIn.second[_ngcontent-%COMP%] {\\n  animation-delay: 0.6s;\\n}\\n.fadeIn.third[_ngcontent-%COMP%] {\\n  animation-delay: 0.8s;\\n}\\n.fadeIn.fourth[_ngcontent-%COMP%] {\\n  animation-delay: 1s;\\n}\\n\\n.underlineHover[_ngcontent-%COMP%]:after {\\n  display: block;\\n  left: 0;\\n  bottom: -10px;\\n  width: 0;\\n  height: 2px;\\n  background-color: #56baed;\\n  content: \\\"\\\";\\n  transition: width 0.2s;\\n}\\n.underlineHover[_ngcontent-%COMP%]:hover {\\n  color: #0d0d0d;\\n}\\n.underlineHover[_ngcontent-%COMP%]:hover:after {\\n  width: 100%;\\n}\\n\\n*[_ngcontent-%COMP%]:focus {\\n  outline: none;\\n}\\n#icon[_ngcontent-%COMP%] {\\n  width: 60%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU1BLFVBQUE7QUFFQTtFQUNFLHlCQUFBO0FBTkY7QUFTQTtFQUNFLGtDQUFBO0VBQ0EsYUFBQTtBQU5GO0FBU0E7RUFDRSxjQUFBO0VBQ0EscUJBQUE7RUFDQSxxQkFBQTtFQUNBLGdCQUFBO0FBTkY7QUFTQTtFQUNFLGtCQUFBO0VBQ0EsZUFBQTtFQUNBLGdCQUFBO0VBQ0EseUJBQUE7RUFDQSxxQkFBQTtFQUNBLHlCQUFBO0VBQ0EsY0FBQTtBQU5GO0FBV0EsY0FBQTtBQUVBO0VBQ0UsYUFBQTtFQUNBLG1CQUFBO0VBQ0Esc0JBQUE7RUFDQSx1QkFBQTtFQUNBLFdBQUE7RUFDQSxnQkFBQTtFQUNBLGFBQUE7QUFURjtBQVlBO0VBRUUsa0NBQUE7RUFDQSxnQkFBQTtFQUNBLGFBQUE7RUFDQSxVQUFBO0VBQ0EsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLFlBQUE7RUFFQSw0Q0FBQTtFQUNBLGtCQUFBO0FBVEY7QUFZQTtFQUNFLHlCQUFBO0VBQ0EsNkJBQUE7RUFDQSxhQUFBO0VBQ0Esa0JBQUE7RUFFQSw0QkFBQTtBQVRGO0FBY0EsU0FBQTtBQUVBO0VBQ0UsY0FBQTtBQVpGO0FBZUE7RUFDRSxjQUFBO0VBQ0EsZ0NBQUE7QUFaRjtBQWlCQSxtQkFBQTtBQUVBO0VBQ0UseUJBQUE7RUFDQSxZQUFBO0VBQ0EsWUFBQTtFQUNBLGtCQUFBO0VBQ0Esa0JBQUE7RUFDQSxxQkFBQTtFQUNBLHFCQUFBO0VBQ0EseUJBQUE7RUFDQSxlQUFBO0VBRUEsaURBQUE7RUFFQSw4QkFBQTtFQUNBLDBCQUFBO0VBS0EsZ0NBQUE7QUFmRjtBQWtCQTtFQUNFLHlCQUFBO0FBZkY7QUFrQkE7RUFLRSxzQkFBQTtBQWZGO0FBa0JBO0VBQ0UseUJBQUE7RUFDQSxZQUFBO0VBQ0EsY0FBQTtFQUNBLGtCQUFBO0VBQ0Esa0JBQUE7RUFDQSxxQkFBQTtFQUNBLHFCQUFBO0VBQ0EsZUFBQTtFQUNBLFdBQUE7RUFDQSxVQUFBO0VBQ0EseUJBQUE7RUFLQSxnQ0FBQTtFQUVBLDhCQUFBO0FBZkY7QUFrQkE7RUFDRSxzQkFBQTtFQUNBLGdDQUFBO0FBZkY7QUFrQkE7RUFDRSxjQUFBO0FBZkY7QUFvQkEsZUFBQTtBQUVBLHVDQUFBO0FBQ0E7RUFFRSwwQkFBQTtFQUVBLHNCQUFBO0VBRUEseUJBQUE7QUFsQkY7QUFrQ0E7RUFDRTtJQUNFLFVBQUE7SUFFQSxtQ0FBQTtFQW5CRjtFQXFCQTtJQUNFLFVBQUE7SUFFQSxlQUFBO0VBbkJGO0FBQ0Y7QUFzQkEsa0NBQUE7QUFHQTtFQUFvQjtJQUFPLFVBQUE7RUFKekI7RUFJc0M7SUFBSyxVQUFBO0VBRDNDO0FBQ0Y7QUFFQTtFQUNFLFVBQUE7RUFHQSwyQkFBQTtFQUlBLDZCQUFBO0VBSUEsc0JBQUE7QUFGRjtBQUtBO0VBR0UscUJBQUE7QUFGRjtBQUtBO0VBR0UscUJBQUE7QUFGRjtBQUtBO0VBR0UscUJBQUE7QUFGRjtBQUtBO0VBR0UsbUJBQUE7QUFGRjtBQUtBLGtDQUFBO0FBQ0E7RUFDRSxjQUFBO0VBQ0EsT0FBQTtFQUNBLGFBQUE7RUFDQSxRQUFBO0VBQ0EsV0FBQTtFQUNBLHlCQUFBO0VBQ0EsV0FBQTtFQUNBLHNCQUFBO0FBRkY7QUFLQTtFQUNFLGNBQUE7QUFGRjtBQUtBO0VBQ0UsV0FBQTtBQUZGO0FBT0EsV0FBQTtBQUVBO0VBQ0ksYUFBQTtBQUxKO0FBUUE7RUFDRSxVQUFBO0FBTEYiLCJmaWxlIjoibG9naW4uY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsb2dpbi1mb3JtIHtcbi8vICAgICBmb250LWZhbWlseTonVGltZXMgTmV3IFJvbWFuJywgVGltZXMsIHNlcmlmO1xuLy8gICAgIGZvbnQtc2l6ZTogMjBweDtcbi8vICAgfVxuXG5cbi8qIEJBU0lDICovXG5cbmh0bWwge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNTZiYWVkO1xufVxuXG5ib2R5IHtcbiAgZm9udC1mYW1pbHk6IFwiUG9wcGluc1wiLCBzYW5zLXNlcmlmO1xuICBoZWlnaHQ6IDEwMHZoO1xufVxuXG5hIHtcbiAgY29sb3I6ICM5MmJhZGQ7XG4gIGRpc3BsYXk6aW5saW5lLWJsb2NrO1xuICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG59XG5cbmgyIHtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuICBmb250LXNpemU6IDE2cHg7XG4gIGZvbnQtd2VpZ2h0OiA2MDA7XG4gIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gIGRpc3BsYXk6aW5saW5lLWJsb2NrO1xuICBtYXJnaW46IDQwcHggOHB4IDEwcHggOHB4OyBcbiAgY29sb3I6ICNjY2NjY2M7XG59XG5cblxuXG4vKiBTVFJVQ1RVUkUgKi9cblxuLndyYXBwZXIge1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIHdpZHRoOiAxMDAlO1xuICBtaW4taGVpZ2h0OiAxMDAlO1xuICBwYWRkaW5nOiAyMHB4O1xufVxuXG4jZm9ybUNvbnRlbnQge1xuICAtd2Via2l0LWJvcmRlci1yYWRpdXM6IDEwcHggMTBweCAxMHB4IDEwcHg7XG4gIGJvcmRlci1yYWRpdXM6IDEwcHggMTBweCAxMHB4IDEwcHg7XG4gIGJhY2tncm91bmQ6ICNmZmY7XG4gIHBhZGRpbmc6IDMwcHg7XG4gIHdpZHRoOiA5MCU7XG4gIG1heC13aWR0aDogNDUwcHg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgcGFkZGluZzogMHB4O1xuICAtd2Via2l0LWJveC1zaGFkb3c6IDAgMzBweCA2MHB4IDAgcmdiYSgwLDAsMCwwLjMpO1xuICBib3gtc2hhZG93OiAwIDMwcHggNjBweCAwIHJnYmEoMCwwLDAsMC4zKTtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xufVxuXG4jZm9ybUZvb3RlciB7XG4gIGJhY2tncm91bmQtY29sb3I6ICNmNmY2ZjY7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGNlOGYxO1xuICBwYWRkaW5nOiAyNXB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIC13ZWJraXQtYm9yZGVyLXJhZGl1czogMCAwIDEwcHggMTBweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwIDEwcHggMTBweDtcbn1cblxuXG5cbi8qIFRBQlMgKi9cblxuaDIuaW5hY3RpdmUge1xuICBjb2xvcjogI2NjY2NjYztcbn1cblxuaDIuYWN0aXZlIHtcbiAgY29sb3I6ICMwZDBkMGQ7XG4gIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjNWZiYWU5O1xufVxuXG5cblxuLyogRk9STSBUWVBPR1JBUEhZKi9cblxuaW5wdXRbdHlwZT1idXR0b25dLCBpbnB1dFt0eXBlPXN1Ym1pdF0sIGlucHV0W3R5cGU9cmVzZXRdICB7XG4gIGJhY2tncm91bmQtY29sb3I6ICM1NmJhZWQ7XG4gIGJvcmRlcjogbm9uZTtcbiAgY29sb3I6IHdoaXRlO1xuICBwYWRkaW5nOiAxNXB4IDgwcHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gIGZvbnQtc2l6ZTogMTNweDtcbiAgLXdlYmtpdC1ib3gtc2hhZG93OiAwIDEwcHggMzBweCAwIHJnYmEoOTUsMTg2LDIzMywwLjQpO1xuICBib3gtc2hhZG93OiAwIDEwcHggMzBweCAwIHJnYmEoOTUsMTg2LDIzMywwLjQpO1xuICAtd2Via2l0LWJvcmRlci1yYWRpdXM6IDVweCA1cHggNXB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNXB4IDVweCA1cHggNXB4O1xuICBtYXJnaW46IDVweCAyMHB4IDQwcHggMjBweDtcbiAgLXdlYmtpdC10cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlLWluLW91dDtcbiAgLW1vei10cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlLWluLW91dDtcbiAgLW1zLXRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2UtaW4tb3V0O1xuICAtby10cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlLWluLW91dDtcbiAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZS1pbi1vdXQ7XG59XG5cbmlucHV0W3R5cGU9YnV0dG9uXTpob3ZlciwgaW5wdXRbdHlwZT1zdWJtaXRdOmhvdmVyLCBpbnB1dFt0eXBlPXJlc2V0XTpob3ZlciAge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzlhY2U3O1xufVxuXG5pbnB1dFt0eXBlPWJ1dHRvbl06YWN0aXZlLCBpbnB1dFt0eXBlPXN1Ym1pdF06YWN0aXZlLCBpbnB1dFt0eXBlPXJlc2V0XTphY3RpdmUgIHtcbiAgLW1vei10cmFuc2Zvcm06IHNjYWxlKDAuOTUpO1xuICAtd2Via2l0LXRyYW5zZm9ybTogc2NhbGUoMC45NSk7XG4gIC1vLXRyYW5zZm9ybTogc2NhbGUoMC45NSk7XG4gIC1tcy10cmFuc2Zvcm06IHNjYWxlKDAuOTUpO1xuICB0cmFuc2Zvcm06IHNjYWxlKDAuOTUpO1xufVxuXG5pbnB1dFt0eXBlPXRleHRdIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2Y2ZjZmNjtcbiAgYm9yZGVyOiBub25lO1xuICBjb2xvcjogIzBkMGQwZDtcbiAgcGFkZGluZzogMTVweCAzMnB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBmb250LXNpemU6IDE2cHg7XG4gIG1hcmdpbjogNXB4O1xuICB3aWR0aDogODUlO1xuICBib3JkZXI6IDJweCBzb2xpZCAjZjZmNmY2O1xuICAtd2Via2l0LXRyYW5zaXRpb246IGFsbCAwLjVzIGVhc2UtaW4tb3V0O1xuICAtbW96LXRyYW5zaXRpb246IGFsbCAwLjVzIGVhc2UtaW4tb3V0O1xuICAtbXMtdHJhbnNpdGlvbjogYWxsIDAuNXMgZWFzZS1pbi1vdXQ7XG4gIC1vLXRyYW5zaXRpb246IGFsbCAwLjVzIGVhc2UtaW4tb3V0O1xuICB0cmFuc2l0aW9uOiBhbGwgMC41cyBlYXNlLWluLW91dDtcbiAgLXdlYmtpdC1ib3JkZXItcmFkaXVzOiA1cHggNXB4IDVweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDVweCA1cHggNXB4IDVweDtcbn1cblxuaW5wdXRbdHlwZT10ZXh0XTpmb2N1cyB7XG4gIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XG4gIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjNWZiYWU5O1xufVxuXG5pbnB1dFt0eXBlPXRleHRdOnBsYWNlaG9sZGVyIHtcbiAgY29sb3I6ICNjY2NjY2M7XG59XG5cblxuXG4vKiBBTklNQVRJT05TICovXG5cbi8qIFNpbXBsZSBDU1MzIEZhZGUtaW4tZG93biBBbmltYXRpb24gKi9cbi5mYWRlSW5Eb3duIHtcbiAgLXdlYmtpdC1hbmltYXRpb24tbmFtZTogZmFkZUluRG93bjtcbiAgYW5pbWF0aW9uLW5hbWU6IGZhZGVJbkRvd247XG4gIC13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uOiAxcztcbiAgYW5pbWF0aW9uLWR1cmF0aW9uOiAxcztcbiAgLXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOiBib3RoO1xuICBhbmltYXRpb24tZmlsbC1tb2RlOiBib3RoO1xufVxuXG5ALXdlYmtpdC1rZXlmcmFtZXMgZmFkZUluRG93biB7XG4gIDAlIHtcbiAgICBvcGFjaXR5OiAwO1xuICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMTAwJSwgMCk7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMTAwJSwgMCk7XG4gIH1cbiAgMTAwJSB7XG4gICAgb3BhY2l0eTogMTtcbiAgICAtd2Via2l0LXRyYW5zZm9ybTogbm9uZTtcbiAgICB0cmFuc2Zvcm06IG5vbmU7XG4gIH1cbn1cblxuQGtleWZyYW1lcyBmYWRlSW5Eb3duIHtcbiAgMCUge1xuICAgIG9wYWNpdHk6IDA7XG4gICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0xMDAlLCAwKTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0xMDAlLCAwKTtcbiAgfVxuICAxMDAlIHtcbiAgICBvcGFjaXR5OiAxO1xuICAgIC13ZWJraXQtdHJhbnNmb3JtOiBub25lO1xuICAgIHRyYW5zZm9ybTogbm9uZTtcbiAgfVxufVxuXG4vKiBTaW1wbGUgQ1NTMyBGYWRlLWluIEFuaW1hdGlvbiAqL1xuQC13ZWJraXQta2V5ZnJhbWVzIGZhZGVJbiB7IGZyb20geyBvcGFjaXR5OjA7IH0gdG8geyBvcGFjaXR5OjE7IH0gfVxuQC1tb3ota2V5ZnJhbWVzIGZhZGVJbiB7IGZyb20geyBvcGFjaXR5OjA7IH0gdG8geyBvcGFjaXR5OjE7IH0gfVxuQGtleWZyYW1lcyBmYWRlSW4geyBmcm9tIHsgb3BhY2l0eTowOyB9IHRvIHsgb3BhY2l0eToxOyB9IH1cblxuLmZhZGVJbiB7XG4gIG9wYWNpdHk6MDtcbiAgLXdlYmtpdC1hbmltYXRpb246ZmFkZUluIGVhc2UtaW4gMTtcbiAgLW1vei1hbmltYXRpb246ZmFkZUluIGVhc2UtaW4gMTtcbiAgYW5pbWF0aW9uOmZhZGVJbiBlYXNlLWluIDE7XG5cbiAgLXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOmZvcndhcmRzO1xuICAtbW96LWFuaW1hdGlvbi1maWxsLW1vZGU6Zm9yd2FyZHM7XG4gIGFuaW1hdGlvbi1maWxsLW1vZGU6Zm9yd2FyZHM7XG5cbiAgLXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246MXM7XG4gIC1tb3otYW5pbWF0aW9uLWR1cmF0aW9uOjFzO1xuICBhbmltYXRpb24tZHVyYXRpb246MXM7XG59XG5cbi5mYWRlSW4uZmlyc3Qge1xuICAtd2Via2l0LWFuaW1hdGlvbi1kZWxheTogMC40cztcbiAgLW1vei1hbmltYXRpb24tZGVsYXk6IDAuNHM7XG4gIGFuaW1hdGlvbi1kZWxheTogMC40cztcbn1cblxuLmZhZGVJbi5zZWNvbmQge1xuICAtd2Via2l0LWFuaW1hdGlvbi1kZWxheTogMC42cztcbiAgLW1vei1hbmltYXRpb24tZGVsYXk6IDAuNnM7XG4gIGFuaW1hdGlvbi1kZWxheTogMC42cztcbn1cblxuLmZhZGVJbi50aGlyZCB7XG4gIC13ZWJraXQtYW5pbWF0aW9uLWRlbGF5OiAwLjhzO1xuICAtbW96LWFuaW1hdGlvbi1kZWxheTogMC44cztcbiAgYW5pbWF0aW9uLWRlbGF5OiAwLjhzO1xufVxuXG4uZmFkZUluLmZvdXJ0aCB7XG4gIC13ZWJraXQtYW5pbWF0aW9uLWRlbGF5OiAxcztcbiAgLW1vei1hbmltYXRpb24tZGVsYXk6IDFzO1xuICBhbmltYXRpb24tZGVsYXk6IDFzO1xufVxuXG4vKiBTaW1wbGUgQ1NTMyBGYWRlLWluIEFuaW1hdGlvbiAqL1xuLnVuZGVybGluZUhvdmVyOmFmdGVyIHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGxlZnQ6IDA7XG4gIGJvdHRvbTogLTEwcHg7XG4gIHdpZHRoOiAwO1xuICBoZWlnaHQ6IDJweDtcbiAgYmFja2dyb3VuZC1jb2xvcjogIzU2YmFlZDtcbiAgY29udGVudDogXCJcIjtcbiAgdHJhbnNpdGlvbjogd2lkdGggMC4ycztcbn1cblxuLnVuZGVybGluZUhvdmVyOmhvdmVyIHtcbiAgY29sb3I6ICMwZDBkMGQ7XG59XG5cbi51bmRlcmxpbmVIb3Zlcjpob3ZlcjphZnRlcntcbiAgd2lkdGg6IDEwMCU7XG59XG5cblxuXG4vKiBPVEhFUlMgKi9cblxuKjpmb2N1cyB7XG4gICAgb3V0bGluZTogbm9uZTtcbn0gXG5cbiNpY29uIHtcbiAgd2lkdGg6NjAlO1xufVxuIl19 */\"]\n});","map":{"version":3,"mappings":"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","names":["AbstractControl","FormControl","FormGroup","Validators","i0","LoginComponent","constructor","apiService","ngOnInit","loginForm","email","required","otp","setValidatorForOTP","otpControl","get","addValidators","updateValueAndValidity","sendOTP","emailDisable","sentOTP","button","sendEmail","Math","floor","random","console","log","response","submit","status","value","retryAttempts","OTP_Verified","screen_lable","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/home/shubham/2023/email_otp/client/src/app/login/login.component.ts","/home/shubham/2023/email_otp/client/src/app/login/login.component.html"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { AbstractControl, FormControl, FormGroup, RequiredValidator, Validators } from '@angular/forms';\nimport { ApiServiceService } from '../api-service.service';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.scss']\n})\nexport class LoginComponent implements OnInit {\n\n  name = 'Angular';\n  button = 'Send OTP';\n  emailDisable : boolean = false;\n  loginForm:any = FormGroup;\n  retryAttempts : number = 10;\n  sentOTP = false;\n  otp: number = 0;\n  email : string = '';\n  showMessage : boolean = false;\n  OTP_Verified : boolean = false;\n  screen_lable : string = 'Login';\n\n\n  constructor(private apiService : ApiServiceService) { }\n\n  ngOnInit(){\n    this.loginForm = new FormGroup({\n      email : new FormControl(null,[Validators.required]),\n      otp : new FormControl()\n    })\n  }\n\n  setValidatorForOTP(){\n    const otpControl: AbstractControl | null = this.loginForm.get('otp');\n      // Check if the control exists\n      if (otpControl) {\n        // Add your custom validator function\n        otpControl.addValidators(Validators.required)\n\n        // Update the validity status\n        otpControl.updateValueAndValidity();\n      }\n  }\n\n  sendOTP(){\n    this.emailDisable = true;\n    this.sentOTP = true;\n    this.button = 'Continue with OTP';\n    \n  }\n\n  async sendEmail(){\n    this.otp = Math.floor(100000 + Math.random() * 900000)\n    console.log(\"otp : \",this.otp);\n    console.log(\"send email on \"+this.email+ \" with OTP : \",this.otp);\n    let response = await this.apiService.sendEmail(this.email,this.otp);\n    console.log(\"response : \",response);\n  }\n  \n  submit(){\n    console.log(\"Form : \",this.loginForm.status)\n    \n    // if(!this.loginForm.value.email.endsWith(\".dso.org.sg\")){\n    //   console.log(\"Please use correct email \");\n    //   this.showMessage = true;\n    //   return;\n    // }else{\n    //   this.showMessage = false;\n    // }\n\n    if(this.loginForm.status == 'VALID' && this.loginForm.value.email \n    // && this.loginForm.value.email.endsWith(\".dso.org.sg\") \n    && !this.loginForm.value.otp){\n        this.email = this.loginForm.value.email;\n        this.setValidatorForOTP();\n        this.sendOTP();   \n        this.sendEmail();   \n    }else if(this.loginForm.status == 'VALID' && this.loginForm.value.email && this.loginForm.value.otp\n     && this.loginForm.value.email && this.email && this.loginForm.value.otp == this.otp){\n      this.retryAttempts = 0;\n      this.OTP_Verified = true;\n      this.screen_lable = 'Email OTP verification done successfully';\n      console.log(\"OTP Verified\")\n\n    }else if(this.loginForm.status == 'VALID' && this.loginForm.value.email && this.loginForm.value.otp\n    && this.loginForm.value.otp != this.otp){\n      this.retryAttempts = this.retryAttempts - 1;\n      console.log(\"Incorrect OTP with remaining attempts : \",this.retryAttempts);\n   }\n  }\n\n}\n","\n<div class=\"wrapper fadeInDown\">\n  <div id=\"formContent\">\n      <div [formGroup]=\"loginForm\">\n        <br>\n        <h3> {{screen_lable}} </h3>\n        <div *ngIf=\"!OTP_Verified\">\n          <div>\n            <input type=\"text\" id=\"email\" class=\"fadeIn second\" formControlName=\"email\" placeholder=\"email\">\n            <br>\n            <label *ngIf=\"showMessage\">Only emails from the \".dso.org.sg\" domain should be allowed</label>\n          </div>\n          <div  *ngIf=\"sentOTP\">\n            <input type=\"text\" id=\"otp\" class=\"fadeIn third\" formControlName=\"otp\" placeholder=\"otp\">\n            <br>\n            <label>Remaining retry attemps : {{retryAttempts}}</label>\n          </div>\n          <input type=\"submit\" (click)=\"submit()\" class=\"fadeIn fourth\" value=\"{{button}}\">\n        </div>\n      </div>\n  </div>\n</div>"]},"metadata":{},"sourceType":"module"}